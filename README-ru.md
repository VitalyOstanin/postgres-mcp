# PostgreSQL MCP Сервер

Также доступно на английском: [README.md](README.md)

[![CI](https://github.com/VitalyOstanin/postgres-mcp/actions/workflows/ci.yml/badge.svg)](https://github.com/VitalyOstanin/postgres-mcp/actions/workflows/ci.yml)
[![npm version](https://img.shields.io/npm/v/@vitalyostanin/postgres-mcp.svg)](https://www.npmjs.com/package/@vitalyostanin/postgres-mcp)

**Примечание**: Этот проект разработан для моих личных нужд. Я не планирую расширять его функциональность возможностями, которые я не использую и не могу проверить. Вы свободны предлагать идеи и создавать pull request'ы, но я не гарантирую, что всё будет принято.

MCP сервер для всесторонней интеграции с PostgreSQL со следующими возможностями:

- **Операции с базами данных** - подключение к экземплярам PostgreSQL, список баз данных и схем
- **Управление таблицами** - список таблиц, представлений, функций и получение детальной информации
- **Инструменты запросов** - выполнение SELECT, INSERT, UPDATE, DELETE запросов с полным синтаксисом PostgreSQL
- **Управление подключениями** - управление подключениями PostgreSQL с поддержкой режима только для чтения
- **Потоковое сохранение в файлы** - потоковое сохранение больших наборов данных в файлы
- **Режим только для чтения** - безопасные операции только для чтения, предотвращающие случайное изменение данных
- **Мониторинг** - статистика базы данных, метрики производительности
- **Операции со схемой** - создание, изменение и удаление таблиц, представлений, функций и индексов

## Таблица содержимого

- [Таблица содержимого](#таблица-содержимого)
- [Требования](#требования)
- [Конфигурация для Qwen Code](#конфигурация-для-qwen-code)
- [Конфигурация для VS Code Cline](#конфигурация-для-vs-code-cline)
- [MCP Инструменты](#mcp-инструменты)
  - [Инструменты для режима только для чтения](#инструменты-для-режима-только-для-чтения)
  - [Инструменты для режима с возможностью записи](#инструменты-для-режима-с-возможностью-записи)

## Требования

- Node.js ≥ 20
- Переменные окружения:
  - `POSTGRES_MCP_CONNECTION_STRING` — строка подключения к PostgreSQL (в формате postgresql://)
  - `POSTGRES_MCP_TIMEZONE` — опциональная таймзона для операций с датами (по умолчанию: `Europe/Moscow`), должна быть валидным идентификатором IANA (например, `Europe/London`, `America/New_York`, `Asia/Tokyo`)
  - `POSTGRES_MCP_POOL_SIZE` — опциональный размер пула подключений (по умолчанию: 1)

## Конфигурация для Qwen Code

Чтобы использовать этот MCP сервер с [Qwen Code](https://qwenlm.github.io/qwen-code-docs/), добавьте в `~/.qwen/settings.json`:

```json
{
  "mcpServers": {
    "postgres-mcp": {
      "command": "npx",
      "args": ["-y", "@vitalyostanin/postgres-mcp@latest"],
      "env": {
        "POSTGRES_MCP_CONNECTION_STRING": "postgresql://localhost:5432/postgres"
      }
    }
  }
}
```

**Примечание:** Эта конфигурация использует npx для запуска опубликованного пакета. Переменные окружения `POSTGRES_MCP_TIMEZONE` и `POSTGRES_MCP_POOL_SIZE` являются опциональными.

## Конфигурация для VS Code Cline

Чтобы использовать этот MCP сервер с расширением [Cline](https://github.com/cline/cline) в VS Code:

1. Откройте VS Code с установленным расширением Cline
2. Нажмите иконку MCP Servers в верхней навигации Cline
3. Выберите вкладку "Configure" и нажмите "Configure MCP Servers"
4. Добавьте следующую конфигурацию в `cline_mcp_settings.json`:

```json
{
  "mcpServers": {
    "postgres-mcp": {
      "command": "npx",
      "args": ["-y", "@vitalyostanin/postgres-mcp@latest"],
      "env": {
        "POSTGRES_MCP_CONNECTION_STRING": "postgresql://localhost:5432/postgres"
      }
    }
  }
}
```

**Примечание:** Эта конфигурация использует npx для запуска опубликованного пакета. Переменные окружения `POSTGRES_MCP_TIMEZONE` и `POSTGRES_MCP_POOL_SIZE` являются опциональными.

## MCP Инструменты

### Инструменты для режима только для чтения

| Инструмент | Описание | Основные параметры |
| --- | --- | --- |
| `service-info` | Получить информацию о сервисе PostgreSQL и текущем состоянии подключения | — |
| `connect` | Установить подключение к PostgreSQL с использованием строки подключения | `readonlyMode` — запуск в режиме только для чтения (по умолчанию: true), `poolSize` — размер пула подключений (по умолчанию: 1), `idleTimeoutMillis` — таймаут простоя в миллисекундах (по умолчанию: 30000), `connectionTimeoutMillis` — таймаут подключения в миллисекундах (по умолчанию: 10000) |
| `disconnect` | Отключиться от PostgreSQL и очистить подключение | — |
| `list-schemas` | Список всех схем в базе данных PostgreSQL | — |
| `list-objects` | Список объектов (таблиц, представлений, функций) в схеме PostgreSQL | `schema` — имя схемы (по умолчанию: 'public'), `type` — тип объектов: 'table', 'view', 'function', 'all' (по умолчанию: 'all') |
| `show-object` | Показать детальную информацию об объекте PostgreSQL (таблице, представлении или функции) | `schema` — имя схемы (по умолчанию: 'public'), `name` — имя объекта (имя таблицы, представления или функции), `type` — тип объекта: 'table', 'view', 'function' |
| `execute-sql` | Выполнение пользовательского SQL запроса к PostgreSQL (поддерживает SELECT, INSERT, UPDATE, DELETE, DDL операции) | `query` — SQL запрос для выполнения, `params` — параметры для SQL запроса (опционально), `saveToFile` — сохранить результаты в файл вместо возврата напрямую. При включении использует потоковую передачу с курсором для запросов SELECT, чтобы избежать проблем с памятью (опционально), `filePath` — явный путь для сохранения файла (опционально, автоматически генерируется если не указан), `forceSaveToFile` — принудительно сохранять результаты в файл даже если запрос не поддерживает потоковую передачу с курсором (например, INSERT, UPDATE, DELETE). Когда этот флаг установлен, не-SELECT запросы также будут сохраняться в файл, но могут потреблять больше памяти. По умолчанию false. |
| `index-operation` | Создание, удаление или список индексов для таблиц PostgreSQL (только операция list в режиме только для чтения) | `operation` — операция для выполнения: 'create', 'drop' или 'list', `schema` — имя схемы, где находится таблица (по умолчанию: 'public'), `table` — имя таблицы для создания/удаления индекса (требуется для create/drop), `name` — имя индекса (требуется для create/drop), `columns` — массив имен колонок для включения в индекс (требуется для create), `unique` — создать уникальный индекс (по умолчанию: false), `ifNotExists` — добавить условие IF NOT EXISTS для операции create (по умолчанию: false), `ifExists` — добавить условие IF EXISTS для операции drop (по умолчанию: false), `tableName` — имя таблицы для получения списка индексов (опционально для операции list) |

### Инструменты для режима с возможностью записи

| Инструмент | Описание | Основные параметры |
| --- | --- | --- |
| `execute-sql` | Выполнение пользовательского SQL запроса к PostgreSQL (поддерживает SELECT, INSERT, UPDATE, DELETE, DDL операции) | `query` — SQL запрос для выполнения, `params` — параметры для SQL запроса (опционально), `saveToFile` — сохранить результаты в файл вместо возврата напрямую. При включении использует потоковую передачу с курсором для запросов SELECT, чтобы избежать проблем с памятью (опционально), `filePath` — явный путь для сохранения файла (опционально, автоматически генерируется если не указан), `forceSaveToFile` — принудительно сохранять результаты в файл даже если запрос не поддерживает потоковую передачу с курсором (например, INSERT, UPDATE, DELETE). Когда этот флаг установлен, не-SELECT запросы также будут сохраняться в файл, но могут потреблять больше памяти. По умолчанию false. |
| `index-operation` | Создание, удаление или список индексов для таблиц PostgreSQL | `operation` — операция для выполнения: 'create', 'drop' или 'list', `schema` — имя схемы, где находится таблица (по умолчанию: 'public'), `table` — имя таблицы для создания/удаления индекса (требуется для create/drop), `name` — имя индекса (требуется для create/drop), `columns` — массив имен колонок для включения в индекс (требуется для create), `unique` — создать уникальный индекс (по умолчанию: false), `ifNotExists` — добавить условие IF NOT EXISTS для операции create (по умолчанию: false), `ifExists` — добавить условие IF EXISTS для операции drop (по умолчанию: false), `tableName` — имя таблицы для получения списка индексов (опционально для операции list) |

**Примечание:** Сервер по умолчанию работает в режиме только для чтения для предотвращения случайного изменения данных. В режиме только для чтения все операции записи заблокированы, включая:
- Операции модификации данных: `INSERT`, `UPDATE`, `DELETE`, DDL инструкции
- Операции с индексами: `create` и `drop` операции в инструменте index-operation
- Любые операции `execute-sql`, содержащие запросы на запись при работе в режиме только для чтения

Следующие операции ограничены в режиме только для чтения:
- DDL операции в `execute-sql` (CREATE, ALTER, DROP и т.д.)
- Операции `create` и `drop` в `index-operation`
Эти операции доступны только когда сервер запущен в режиме чтения-записи.
